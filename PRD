제시해주신 문제점들(리스트 들여쓰기 불편함, HTML 태그의 가독성과 렌더링 한계, 헤딩 접기의 구조적 지저분함)에 깊이 공감합니다. 이를 해결하기 위해 **"노션의 사용자 경험을 마크다운 환경에서 네이티브하게 구현"**하는 것을 목표로 PRD를 작성해 드립니다.

이 PRD는 AI(바이브코딩)가 바로 이해하고 코드를 짤 수 있도록 넘버링과 목적 중심으로 구성되었습니다.

---

# PRD: Obsidian Notion-Style Toggle Plugin

## 1. 개요 (Overview)
* **목적:** 리스트 들여쓰기나 복잡한 HTML 태그 없이, 특정 기호만으로 노션처럼 깔끔하게 접고 펼칠 수 있는 토글 블록 구현.
* **핵심 가치:** 
    1. 마크다운 문법 파괴 최소화 (복사 붙여넣기 시 가독성 유지).
    2. 엔터/줄바꿈이 자유로운 내부 콘텐츠 공간 확보.
    3. 시각적으로 노션과 동일한 삼각형 아이콘 UI 제공.

## 2. 기능 요구사항 (Functional Requirements)

### 2.1. 토글 트리거 문법 (Syntax)
* **[2.1.1]** **시작 태그:** 행의 시작 부분에 `|> ` (파이프, 꺽쇠, 공백)를 입력하면 해당 줄은 '토글 제목'이 된다.
* **[2.1.2]** **종료 태그:** 행의 시작 부분에 `<|` (꺽쇠, 파이프)가 입력되면 해당 줄 바로 앞까지가 토글의 내용 범위가 된다.
    * 예시:
        ```
        |> 토글 제목
        내용1
        내용2
        <|
        ```

### 2.2. 에디터 UI 및 렌더링 (Live Preview UI)
* **[2.2.1]** `|> ` 문법이 감지되면 에디터 상에서 해당 기호를 숨기고, 그 자리에 **검은색 삼각형 아이콘(▶/▼)**을 렌더링한다.
* **[2.2.2]** 삼각형 아이콘을 클릭하면 `|>` 줄 다음부터 `<|` 줄 직전까지의 내용이 숨겨지거나 나타난다.
* **[2.2.3]** `<|` (종료 태그) 줄은 토글이 닫혀도 보이거나, 혹은 구현 편의상 항상 흐리게 표시할 수 있다. (사용자 경험상 종료 태그 자체는 제어 문자로 취급하여, 토글이 닫힐 때 같이 숨겨지거나 유지될 수 있음. 여기서는 '내용'과 함께 숨겨지는 것을 기본으로 한다.)

### 2.3. 콘텐츠 처리 (Content Handling)
* **[2.3.1]** 토글 내부에서는 일반적인 마크다운 줄바꿈(Enter)이 자유롭게 허용되어야 하며, 인위적인 들여쓰기(Space 2칸)를 강제하지 않는다.
* **[2.3.2]** 토글 내부에 작성된 마크다운 문법(굵게, 기울임, 링크 등)은 옵시디언 기본 스타일대로 정상 렌더링되어야 한다.

### 2.4. 상태 유지 (State Persistence)
* **[2.4.1]** 특정 토글이 열려 있는지 닫혀 있는지의 상태는 파일 내부에 메타데이터(예: `%%fold:true%%`) 혹은 플러그인 캐시를 통해 저장되어, 파일을 다시 열어도 유지되어야 한다.

---

## 3. 기술적 제약 및 스타일 (Technical Constraints)

### 3.1. 에디터 엔진 활용
* **[3.1.1]** CodeMirror 6의 `Decoration.widget`을 사용하여 삼각형 아이콘을 삽입한다.
* **[3.1.2]** `Decoration.replace` 또는 `Decoration.line` 스타일을 사용하여 접힌 구간의 텍스트를 숨긴다.

### 3.2. 성능 및 호환성
* **[3.2.1]** 대용량 문서에서도 토글 클릭 시 지연 시간이 없어야 한다 (Event-Driven 방식).
* **[3.2.2]** 옵시디언 기본 테마 및 다크 모드와 이질감 없이 어울리는 SVG 아이콘을 사용한다.

---

# [General Guideline] PRD-Context Driven Development (Lite)

## 1. 코드 작성 원칙
* **[ID] 무엇을 -> 왜:** 모든 주요 함수와 로직 상단에 PRD 번호를 명시한다.
* **No Polling:** 문서 전체를 주기적으로 스캔하지 말고, 변경된 Line에 대해서만 반응하는 CodeMirror ViewUpdate 이벤트를 활용한다.

---

## 💡 바이브코딩을 위한 팁 (AI에게 요청할 때)

이제 이 PRD를 복사해서 AI에게 주면서 다음과 같이 시작해 보세요:

> "옵시디언 플러그인을 만들려고 해. 첨부한 PRD 문서를 읽고, 우선 **[2.1.1]**과 **[2.2.1]** 항목인 `>> ` 문법을 감지해서 에디터에 삼각형 아이콘을 띄우는 기본 ViewPlugin 코드부터 짜줘. 옵시디언 공식 API와 CodeMirror 6를 사용해줘."
